const MIN_RAD=1,MAX_RAD=2,MIN_VISUAL=24,MAX_VISUAL=72,MIN_RAD2=.65,MAX_RAD2=3.1,MIN_VISUAL2=72,MAX_VISUAL2=256,MIN_ORBIT=1,MAX_ORBIT=1e3,PARSEC_LIGHTYEAR=3.26156378,SOL_MAG=4.83,POGSON=-2.5,FLUX_INNER=1.1,FLUX_OUTTER=.53,SPECTRAL_TYPES=["B","A","F","G","K","M"],SPECTRAL_BC=[-2,-.3,-.15,-.4,-.8,-2],LIMIT=4197,EMPTY_VALUE="EMPTY",BASE_URL="/projects/exoplanets/",SEARCH_TYPES=["pl_name","pl_hostname","pl_disc"];let VALUES=[],DATA=[];function get(t,e){const i=VALUES.indexOf(t);return-1!==i&&""!==e[i]?e[i]:EMPTY_VALUE}function getListItemDataHTML(t,e,i){return'<span class="'+i+'"><span class="list-value-label">'+t+":</span> "+String(e)+"</span>"}function getListItemHTML(t){const e=get("rowid",t),i=get("pl_name",t),a=get("pl_disc",t);let n=get("st_dist",t);return n=(n*=PARSEC_LIGHTYEAR).toFixed(2),'<div class="list-item" id="'+e+'"><div class="left"><div class="visual"></div></div><div class="right"><span class="title">'+i+"</span>"+getListItemDataHTML("Found in",a,"year")+getListItemDataHTML("Distance",n+" ly","distance")+"</div></div>"}function getMainDetailLabelHTML(t){return'<span class="value-label">'+t+":</span>"}function getMainDetailValueHTML(t){return"<span>"+t+"</span>"}function hsvToRgb(t,e,i){let a,n,s,l,o,c,r,d;switch(c=i*(1-e),r=i*(1-(o=6*t-(l=Math.floor(6*t)))*e),d=i*(1-(1-o)*e),l%6){case 0:a=i,n=d,s=c;break;case 1:a=r,n=i,s=c;break;case 2:a=c,n=i,s=d;break;case 3:a=c,n=r,s=i;break;case 4:a=d,n=c,s=i;break;case 5:a=i,n=c,s=r;break;default:a=1,n=1,s=1}return"rgb("+Math.round(255*a)+", "+Math.round(255*n)+", "+Math.round(255*s)+")"}function getURLParameter(t){const e=new URLSearchParams(window.location.search);return e.has(t)?e.get(t):""}function getBaseLog(t,e){return Math.log(e)/Math.log(t)}function getHabitableZone(t){const e=get("gaia_gmag",t),i=get("st_optmag",t);let a;if(e===EMPTY_VALUE&&i===EMPTY_VALUE)return[0,0];e!==EMPTY_VALUE&&i===EMPTY_VALUE?a=e:e===EMPTY_VALUE&&i!==EMPTY_VALUE&&(a=i);let n=get("st_dist",t);const s=get("st_spstr",t).substring(0,1),l=SPECTRAL_TYPES.indexOf(s);let o=a-5*Math.log(n)+(-1!==l?SPECTRAL_BC[l]:-2),c=Math.pow(10,(o-SOL_MAG)/POGSON);return[Math.sqrt(c/FLUX_INNER).toFixed(2),Math.sqrt(c/FLUX_OUTTER).toFixed(2)]}function scaled(t,e,i,a,n){return t<e?t=e:t>i&&(t=i),a+(n-a)*(t-e)/(i-e)}function setVisual(t,e,i,a,n,s){let l=get("pl_rade",t),o=get("pl_orbper",t);o>MAX_ORBIT?o=MAX_ORBIT:o<MIN_ORBIT&&(o=MIN_ORBIT);const c=hsvToRgb(scaled(o,MIN_ORBIT,MAX_ORBIT,0,360),.7,.95);l===EMPTY_VALUE?l=i+(a-i)/2:l>a?l=a:l<i&&(l=i);const r=Math.round(scaled(l,i,a,n,s));e.css("width",r+"px"),e.css("height",r+"px"),e.css("background-color",c)}function list_readyResults(){$("div.list-container > span.list-start").hide(),$("div.list-container > span.list-none").hide(),$("div.list-container").removeClass("list-container-empty"),$("div.list-container > div.list-item").off(),$("div.list-container > div.list-item").remove()}function list_noResults(){$("div.list-container > div.list-item").remove(),$("div.list-container").addClass("list-container-empty"),$("div.list-container > span.list-none").show(),$("div.list-container > span.list-start").hide()}function exoKeyUp(t){13===(t.keyCode||t.which)&&exoDoQuery($("input.exo-search").val())}function exoDoQuery(t){const e=$("select.exo-search-type").val();let i=!1;if($.each(SEARCH_TYPES,function(t,a){a===e&&(i=!0)}),!i)return void alert('There was a problem with validating the search type! ("'+e+'")');if(i=!1,""===t)return;const a=t.toLowerCase();t.includes(" ")&&(t=t.replace(/\s/g,"")),t.includes("-")&&(t=t.replace(/-/g,"")),t.includes("+")&&(t=t.replace(/\+/g,"")),!1!==/^[a-z0-9]+$/i.test(t)?exoSearch(a,e):alert('Invalid query! (can only include letters, numbers, spaces or "+" and "-")')}function exoSearch(t,e){let i=!1;const a=$("div.list-container");$.each(DATA,function(n,s){if(String(get(e,s)).toLowerCase().includes(t)){i||(list_readyResults(),i=!0),a.append(getListItemHTML(s));const t=get("rowid",s);setVisual(s,$("div.list-item#"+t+" > div.left > div.visual"),MIN_RAD,MAX_RAD,MIN_VISUAL,MAX_VISUAL)}}),i?exoRegisterListItemClicks():list_noResults()}function exoRegisterListItemClicks(){$("div.list-container > div.list-item").each(function(){const t=$(this).attr("id");$("div.list-container > div.list-item#"+t).on("click",function(){listItemClick(t)})})}function listItemClick(t){window.location=BASE_URL+"?id="+String(t)}function outputMainDetail(t,e){t=t.toString(),$("div.main-details-container div.main-details-labels").append(getMainDetailLabelHTML(e)),$("div.main-details-container div.main-details-values").append(getMainDetailValueHTML(t.includes(EMPTY_VALUE)?'<span style="color:grey">Unknown</span>':t))}function outputAllDetails(t){let e=$("div.all-data-container div.all-data-labels"),i=$("div.all-data-container div.all-data-values");for(let a of VALUES){e.append(getMainDetailLabelHTML(a));const n=get(a,t);i.append(getMainDetailValueHTML(n.includes(EMPTY_VALUE)?'<span style="color:grey">Unknown</span>':n))}}function go_details(t){$("div.exo-container#search").hide(),$("div.exo-container#details").show();let e=[];for(let i of DATA)if(get("rowid",i)===t){e=i;break}const i=get("pl_name",e);$("title").html(i),$("div.main-card-text > h1").html(i),outputMainDetail(get("st_dist",e)*PARSEC_LIGHTYEAR,"Distance (ly)"),outputMainDetail(get("pl_orbper",e),"Orbit (days)"),outputMainDetail(get("pl_masse",e),"Mass (Earth)"),outputMainDetail(get("pl_rade",e),"Radius (Earth)"),outputMainDetail(get("pl_orbeccen",e),"Eccentricity"),outputMainDetail(get("pl_disc",e)+" ("+get("pl_discmethod",e)+")","Discovered"),setVisual(e,$("div.main-card > div.main-card-visual"),MIN_RAD2,MAX_RAD2,MIN_VISUAL2,MAX_VISUAL2),outputAllDetails(e);let a=$("button.all-data-toggle");a.on("click",function(t){let e=$("div.all-data-container");e.is(":visible")?(a.html("Show"),e.hide()):(a.html("Hide"),e.show())}),$("button.go-back").on("click",function(t){window.location=BASE_URL})}function exoGo(){const t=getURLParameter("id");/[0-9]/.test(t)&&parseFloat(t)<=LIMIT&&parseFloat(t)>=0?go_details(t):""!==t&&alert("Invalid ID (must be between 0 and "+LIMIT+")")}$(document).ready(function(){$.getJSON("/resources/json/exoplanets-values.json",function(t){$.getJSON("/resources/json/exoplanets-data.json",function(e){VALUES=t,DATA=e,exoGo()})})});